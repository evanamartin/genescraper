---
title: "geneScrapeR"
author: "Evan A Martin"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{geneScrapeR}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r,echo=FALSE,results='hide',message=FALSE}
knitr::opts_chunk$set(collapse = T, comment = '')
options(tibble.print_min = 5)
library (geneScrapeR)
```

The main reason geneScrapeR was created is to extract the names of the genes mentioned in publications from the NCBI databases. Any of the databases on this site can be searched but we will focus on publications in PubMed. There are two functions in geneScrapeR. The fist function, scrapeIDs, uses the R package rentrez to search publications from NCBI databases and extract their ID. This function stores all of the IDs from publications that match your search criteria in a list. The second function, extractGenes, connects to the PubTator website and extracts the Entrez Gene ID for each gene mentioned in the abstract. After extracting each gene id from each abstract extractGenes then converts the gene ids to the approved gene symbol. This information was taken from the HUGO Gene Nomenclature Committee (HGNC) website.

This function may take a very long time to run. The runtime for searching one abstract and extracting the genes mentioned in it is aproximately 1 second. The function can run in parallel but if you are searching hundreds of thousands of abstracts it can still take many hours. The output of extractGenes is a list of the entrez gene ids found in each abstract. Below is an example of the output of these two funcitons.


```{r}
pmids <- scrapeIDs (dataBase = 'pubmed',
                    term = 'prostate cancer[MeSH Terms])')

pmids[1:10]
```

The scrapeIDs returns a list of all of the IDs that match the serach criteria. These IDs can then be passed to the extractGenes function. Which accesses the PubTator website and extracts all of the gene ids associated with each article. The output is NULL if no gene is mentioned in the abstract.

```{r,comment=''}
genes <- extractGenes (IDs = pmids[1:100],
                       nCores = 2,
                       nTries = 5)

unlist (genes[1:10])

geneSymbols <- cleanGenes (geneList = genes)

geneSymbols
```

Using ggplot2 we can look at which genes are most commonly mentioned in connection with prostate cancer. To make the plot more readable we will only look at the top 15.

```{r,message=FALSE}
library (ggplot2)
library (magrittr)
library (dplyr)

geneSymbols$human[1:15, ] %>%
  ggplot () +
  geom_bar (mapping = aes (x = reorder(geneSymbol, -n), y = n),
            stat = 'identity',
            width = 0.5) +
  xlab ('Gene') +
  ylab ('Counts') +
  theme (axis.text.x = element_text (angle = 90, hjust = 1))
```
